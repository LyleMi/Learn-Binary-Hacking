系统启动流程
========================================

流程简介
----------------------------------------
接通电源后，进行开机自检 (Power On Self Test, POST) ，检测计算机硬件设备是否存在故障。

随后计算机加载BIOS或UEFI，进行相应的启动程序。BIOS中记录了主板的相关设置，如启动设备、硬盘信息、系统时间等。BIOS/UEFI根据设定的引导次序读取硬盘，通过硬盘的主引导记录MBR读取Boot loader。Boot loader加载Grub程序。

GRUB程序加载内核文件，内核探测硬件并加载驱动 (initrd) ，挂载根文件系统。

之后执行 ``/sbin/init`` 作为所有系统进程的起点。 ``init`` 将 ``initrd`` 中的 ``/proc`` ``/sys`` ``/dev`` 挂载到当前的主分区中的相应目录。通过mknod完成字符设备、块设备的创建，再完成内核模块的加载，最后完成根切换。

``init`` 之后完毕之后读取配置文件 ``/etc/inittab`` ，并根据 ``inittab`` 执行相应程序。

``initab`` 通常先执行 ``/etc/rc.d/rc.sysinit`` ，``rc.sysinit`` 进行设定主机名、挂载/etc/fstab中其他文件系统、启动swap分区、基于 ``/etc/sysctl.conf`` 设定内核参数等操作。

然后根据不同的运行级别执行 ``/etc/rcX.d/`` 目录下的文件， 例如运行级别为5时，执行 ``/etc/rc5.d/`` 下的文件，接着执行 ``/etc/rc.d/rc.local`` ，最后设置好tty，为用户登录做准备。

常见内核文件
----------------------------------------
- vmlinux
    - 编译出来的最原始的内核文件，未压缩。
- zImage
    - vmlinux经过gzip压缩后的文件。
    - zImage解压缩内核到低端内存(第一个640K)
- bzImage
    - bz表示 ``big zImage``
    - bzImage解压缩内核到高端内存(1M以上)
- uImage
    - U-boot专用的映像文件，在zImage之前加上一个长度为0x40的tag
- vmlinuz
    - bzImage/zImage文件的拷贝或指向bzImage/zImage的链接。
- initrd
    - ``initial ramdisk`` 的简写
    - 一般被用来临时的引导硬件到实际内核vmlinuz能够接管并继续引导的状态

运行级别
----------------------------------------
默认运行级别如下：

+------+---------------------------------+
| 级别 | 含义                            |
+======+=================================+
| 0    | halt                            |
+------+---------------------------------+
| 1    | single user mode                |
+------+---------------------------------+
| 2    | multi user mode, without NFS    |
+------+---------------------------------+
| 3    | multi user mode, text mode      |
+------+---------------------------------+
| 4    | reserved                        |
+------+---------------------------------+
| 5    | multi user mode, graphic mode   |
+------+---------------------------------+
| 6    | reboot                          |
+------+---------------------------------+
